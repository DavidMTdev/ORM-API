{% extends "base.html" %}
{% block title %}Profil - {{user.results.username}}{% endblock %}

{% block link %}
<link rel="stylesheet" href="{{ url_for('static',filename='css/popup.css') }}">{% endblock %}
{% block body %}

{% if error != None %}
<p>{{error}}</p>
{% endif %}

<div class="container">
    <h1>profil</h1>

    {% if id == None %}

    <button type="submit" class="add-talk-js">Modifier Profil</button>
    <button><a href="{{url_for('post.index')}}">Créer un nouveau post</a></button>

    {% else %}

    <button><a href="{{url_for('message.talk', id=user.results.id)}}">Écrire un message</a></button>

    <form action="" method="post">
        {% if follow == 1 %}
        <button type="submit" name="followUser">S'abonner</button>
        {% else %}
        <button type="submit" name="unfollowUser">Se désabonner</button>
        {% endif %}
    </form>
    {% endif %}


    <p>Nom : {{user.results.username}}</p>
    <p>Age : {{user.results.age}}</p>
    <p>Adresse mail : {{user.results.mail}}</p>
    <img src="../../../static/img/{{user.results.avatar}}" alt="">

    <p>Post(s) : {{stats.posts}}</p>
    {% if id == None %}
    <button><a href="{{ url_for('main.followers', id=None ) }}">Abonnements : {{stats.following}}</a></button>
    <button><a href="{{ url_for('main.following', id=None ) }}">Abonné : {{stats.followers}}</a></button>
    {% else %}
    <button><a href="{{ url_for('main.followers', id=id ) }}">Abonnements : {{stats.following}}</a></button>
    <button><a href="{{ url_for('main.following', id=id ) }}">Abonné : {{stats.followers}}</a></button>
    {% endif %}



    <h1>Posts</h1>

    {% for post in user.results.posts %}
    <div>
        <div class="mb-3">
            <form action="" method="post">
                <input type="hidden" name="post" value="{{post.id}}">
                <button>Suprimer(X)</button>
            </form>
        </div>
        <div class="card mb-3">
            {% if post.image != None %}
            <img src="/static/uploads/{{post.user_id}}/posts/{{post.id}}/{{post.image}}" class="card-img-top" alt="..."
                height="350">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{ post.title }}</h5>
                <p class="card-text">{{ post.content }}</p>
                <p class="card-text">{{ post.like }}</p>
                <p class="card-text"><small class="text-muted">Poster par
                        {{ user.results.username + ' le ' + post.publication_date }}</small></p>
                <div class="d-flex">
                    <form action="{{ url_for('post.index') }}" method="post">
                        <input type="hidden" name="postId" value="{{ post.id }}">
                        <input type="hidden" name="type" value="like">
                        <button type="submit" name="like" value="like">like</button>
                    </form>
                </div>
            </div>

        </div>
        {% endfor %}

    </div>

    {% if id == None %}
    <div class="popup">
        <div class="popup-content">
            <img class="close" src="{{ url_for('static',filename='img/close.png') }}" alt="">
            <form action="" method="post" enctype="multipart/form-data">
                <label for="">username</label>
                <input type="text" name="username" value="{{user.results.username}}">

                <label for="">age</label>
                <input type="number" name="age" value="{{user.results.age}}">

                <label for="">avatar</label>
                <input type="file" name="avatar">

                <button type="submit">modifier</button>
            </form>
        </div>
    </div>
    {% endif %}

    {% block js %}
    <script src="{{ url_for('static',filename='js/popup.js') }}"></script>
    {% endblock %}

    {% endblock body %}